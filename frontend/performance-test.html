<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Testing Dashboard</title>
    <script src="js/config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .metric-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .metric-unit {
            font-size: 1rem;
            color: #999;
        }

        .test-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .test-section h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .test-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .log-entry {
            padding: 0.25rem 0;
            border-bottom: 1px solid #333;
        }

        .log-success {
            color: #4caf50;
        }

        .log-error {
            color: #f44336;
        }

        .log-info {
            color: #2196f3;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            width: 0%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Performance Testing Dashboard</h1>

        <!-- Metrics Dashboard -->
        <div class="dashboard-grid">
            <div class="metric-card">
                <div class="metric-title">API Response Time</div>
                <div class="metric-value" id="api-time">--</div>
                <div class="metric-unit">ms</div>
            </div>

            <div class="metric-card">
                <div class="metric-title">Events Loaded</div>
                <div class="metric-value" id="events-loaded">0</div>
                <div class="metric-unit">events</div>
            </div>

            <div class="metric-card">
                <div class="metric-title">Images Loaded</div>
                <div class="metric-value" id="images-loaded">0</div>
                <div class="metric-unit">images</div>
            </div>

            <div class="metric-card">
                <div class="metric-title">Memory Usage</div>
                <div class="metric-value" id="memory-usage">--</div>
                <div class="metric-unit">MB</div>
            </div>
        </div>

        <!-- API Tests -->
        <div class="test-section">
            <h2>ðŸ“¡ API Pagination Tests</h2>
            <div class="test-buttons">
                <button onclick="testPagination()">Test Pagination</button>
                <button onclick="testSearch()">Test Search</button>
                <button onclick="testFilters()">Test Filters</button>
                <button onclick="testLoadSpeed()">Test Load Speed</button>
                <button onclick="clearLogs()">Clear Logs</button>
            </div>
            <div class="progress-bar" id="progress-bar" style="display: none;">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="log-container" id="log-container"></div>
        </div>

        <!-- Performance Tests -->
        <div class="test-section">
            <h2>âš¡ Performance Tests</h2>
            <div class="test-buttons">
                <button onclick="testInfiniteScroll()">Test Infinite Scroll</button>
                <button onclick="testLazyLoading()">Test Lazy Loading</button>
                <button onclick="testMemoryUsage()">Test Memory Usage</button>
                <button onclick="stressTest()">Stress Test (Load 100 pages)</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = API_CONFIG.BASE_URL;
        let testResults = [];

        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;

            testResults.push({ time: Date.now(), message, type });
        }

        function clearLogs() {
            document.getElementById('log-container').innerHTML = '';
            testResults = [];
            log('Logs cleared', 'info');
        }

        function updateMetric(id, value) {
            document.getElementById(id).textContent = value;
        }

        function showProgress(percent) {
            const progressBar = document.getElementById('progress-bar');
            const progressFill = document.getElementById('progress-fill');
            progressBar.style.display = 'block';
            progressFill.style.width = percent + '%';
        }

        function hideProgress() {
            document.getElementById('progress-bar').style.display = 'none';
        }

        // Test 1: Pagination
        async function testPagination() {
            log('Starting pagination test...', 'info');
            
            for (let page = 1; page <= 3; page++) {
                const start = performance.now();
                const response = await fetch(`${API_BASE}/events?page=${page}&limit=12`);
                const data = await response.json();
                const end = performance.now();
                
                const time = Math.round(end - start);
                updateMetric('api-time', time);
                
                log(`Page ${page}: ${data.events.length} events loaded in ${time}ms`, 'success');
                log(`Total events: ${data.pagination.total}, Has more: ${data.pagination.hasMore}`, 'info');
            }
            
            log('Pagination test complete!', 'success');
        }

        // Test 2: Search
        async function testSearch() {
            log('Starting search test...', 'info');
            
            const searchTerms = ['music', 'sports', 'tech', 'art'];
            
            for (const term of searchTerms) {
                const start = performance.now();
                const response = await fetch(`${API_BASE}/events?search=${term}&limit=12`);
                const data = await response.json();
                const end = performance.now();
                
                const time = Math.round(end - start);
                log(`Search "${term}": Found ${data.events.length} events in ${time}ms`, 'success');
            }
            
            log('Search test complete!', 'success');
        }

        // Test 3: Filters
        async function testFilters() {
            log('Starting filter test...', 'info');
            
            const categories = ['Music', 'Sports', 'Technology', 'Arts'];
            
            for (const category of categories) {
                const start = performance.now();
                const response = await fetch(`${API_BASE}/events?category=${category}&limit=12`);
                const data = await response.json();
                const end = performance.now();
                
                const time = Math.round(end - start);
                log(`Category "${category}": Found ${data.events.length} events in ${time}ms`, 'success');
            }
            
            log('Filter test complete!', 'success');
        }

        // Test 4: Load Speed
        async function testLoadSpeed() {
            log('Starting load speed test...', 'info');
            
            const iterations = 10;
            const times = [];
            
            for (let i = 1; i <= iterations; i++) {
                showProgress((i / iterations) * 100);
                
                const start = performance.now();
                const response = await fetch(`${API_BASE}/events?page=1&limit=12`);
                await response.json();
                const end = performance.now();
                
                times.push(end - start);
                log(`Request ${i}: ${Math.round(end - start)}ms`, 'info');
            }
            
            hideProgress();
            
            const avgTime = Math.round(times.reduce((a, b) => a + b, 0) / times.length);
            const minTime = Math.round(Math.min(...times));
            const maxTime = Math.round(Math.max(...times));
            
            log(`Average: ${avgTime}ms, Min: ${minTime}ms, Max: ${maxTime}ms`, 'success');
            updateMetric('api-time', avgTime);
        }

        // Test 5: Infinite Scroll Simulation
        async function testInfiniteScroll() {
            log('Starting infinite scroll simulation...', 'info');
            
            let page = 1;
            let hasMore = true;
            let totalEvents = 0;
            
            while (hasMore && page <= 5) {
                showProgress((page / 5) * 100);
                
                const start = performance.now();
                const response = await fetch(`${API_BASE}/events?page=${page}&limit=12`);
                const data = await response.json();
                const end = performance.now();
                
                totalEvents += data.events.length;
                hasMore = data.pagination.hasMore;
                
                log(`Page ${page}: Loaded ${data.events.length} events in ${Math.round(end - start)}ms`, 'success');
                updateMetric('events-loaded', totalEvents);
                
                page++;
                await new Promise(resolve => setTimeout(resolve, 500)); // Simulate scroll delay
            }
            
            hideProgress();
            log(`Infinite scroll complete! Total events: ${totalEvents}`, 'success');
        }

        // Test 6: Lazy Loading Simulation
        async function testLazyLoading() {
            log('Starting lazy loading simulation...', 'info');
            
            const response = await fetch(`${API_BASE}/events?page=1&limit=12`);
            const data = await response.json();
            
            let loadedImages = 0;
            const totalImages = data.events.length;
            
            for (let i = 0; i < totalImages; i++) {
                showProgress(((i + 1) / totalImages) * 100);
                
                // Simulate lazy load delay
                await new Promise(resolve => setTimeout(resolve, 100));
                loadedImages++;
                updateMetric('images-loaded', loadedImages);
                log(`Image ${i + 1}/${totalImages} loaded`, 'info');
            }
            
            hideProgress();
            log('Lazy loading complete!', 'success');
        }

        // Test 7: Memory Usage
        function testMemoryUsage() {
            if (performance.memory) {
                const usedMB = (performance.memory.usedJSHeapSize / 1048576).toFixed(2);
                const totalMB = (performance.memory.totalJSHeapSize / 1048576).toFixed(2);
                
                updateMetric('memory-usage', usedMB);
                log(`Memory: ${usedMB}MB / ${totalMB}MB`, 'info');
                log(`Memory usage: ${((usedMB / totalMB) * 100).toFixed(1)}%`, 'success');
            } else {
                log('Memory API not available in this browser', 'error');
            }
        }

        // Test 8: Stress Test
        async function stressTest() {
            if (!confirm('This will load 100 pages. Continue?')) return;
            
            log('Starting stress test (100 pages)...', 'info');
            
            const startMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            const startTime = performance.now();
            let totalEvents = 0;
            let failedRequests = 0;
            
            for (let page = 1; page <= 100; page++) {
                showProgress((page / 100) * 100);
                
                try {
                    const response = await fetch(`${API_BASE}/events?page=${page}&limit=12`);
                    const data = await response.json();
                    totalEvents += data.events.length;
                    
                    if (page % 10 === 0) {
                        log(`Completed ${page} pages, ${totalEvents} events`, 'info');
                    }
                } catch (error) {
                    failedRequests++;
                    log(`Failed to load page ${page}`, 'error');
                }
            }
            
            const endTime = performance.now();
            const endMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            const totalTime = Math.round(endTime - startTime);
            const memoryIncrease = ((endMemory - startMemory) / 1048576).toFixed(2);
            
            hideProgress();
            
            log(`Stress test complete!`, 'success');
            log(`Total time: ${totalTime}ms (${(totalTime / 1000).toFixed(2)}s)`, 'success');
            log(`Total events: ${totalEvents}`, 'success');
            log(`Failed requests: ${failedRequests}`, failedRequests > 0 ? 'error' : 'success');
            log(`Memory increase: ${memoryIncrease}MB`, 'info');
            log(`Average time per page: ${Math.round(totalTime / 100)}ms`, 'info');
            
            updateMetric('events-loaded', totalEvents);
            if (performance.memory) {
                updateMetric('memory-usage', (endMemory / 1048576).toFixed(2));
            }
        }

        // Auto-update memory usage every 5 seconds
        setInterval(() => {
            if (performance.memory) {
                const usedMB = (performance.memory.usedJSHeapSize / 1048576).toFixed(2);
                updateMetric('memory-usage', usedMB);
            }
        }, 5000);

        // Initial log
        log('Performance testing dashboard ready', 'success');
        log(`Make sure the server is running on ${API_CONFIG.BASE_URL}`, 'info');
    </script>
</body>
</html>


